define(['jquery','underscore','d3'],function($,_){'use strict';var stageCenterX,stageCenterY,pointerCenterX,pointerCenterY;var Js_HallMap_Stage=function(hallMap,primitiveNode,direction){this._hallMap=hallMap;this._primitiveNode=primitiveNode;this._direction=direction;this._$element=$(document.createElement('div'));this._$element.addClass('jsHallMapStage-pointer hallMapStage-pointer');this._$element.click(_.bind(this._onElementClick,this));this._$arrow=$(document.createElement('img'));this._$arrow.addClass('jsHallMapStage-pointer-arrow arrow');this._$arrow.attr('src','img/stage-pointer-arrow.svg');this._$element.append(this._$arrow);var $text=$(document.createElement('a'));$text.addClass('jsHallMapStage-pointer-text text');$text.attr('href','javascript:void(0)');$text.text('STAGE');this._$element.append($text);$(this._hallMap.getElement()).append(this._$element[0]);};Js_HallMap_Stage.prototype.positionate=function(skipTrackStage){pointerCenterX=parseInt(this._$element.css('left'))+parseInt(this._$element.css('margin-left'))+parseInt(this._$arrow.css('width'))/2;pointerCenterY=this._hallMap.getViewportHeight()-parseInt(this._$element.css('bottom'))-parseInt(this._$arrow.css('height'))/2;if(!skipTrackStage){this.trackStage();}};Js_HallMap_Stage.prototype.getPrimitiveNode=function(){return this._primitiveNode;};Js_HallMap_Stage.prototype.getDirection=function(){return this._direction;};Js_HallMap_Stage.prototype.trackStage=function(){var screenBorder;try{screenBorder=this._hallMap.getPrimitiveNodeScreenBorder(this._primitiveNode);}catch(ex){return;}
if(!pointerCenterX){this.positionate(true);}
stageCenterX=screenBorder.x1+screenBorder.width/2;stageCenterY=screenBorder.y1+screenBorder.height/2;var angle=Math.atan2(stageCenterY-pointerCenterY,stageCenterX-pointerCenterX);angle=angle*360/(2*Math.PI);if(angle<0){angle+=360;}
this._$arrow.css({transform:'rotate('+angle+'deg)'});};Js_HallMap_Stage.prototype._onElementClick=function(event){event.stopPropagation();this._$element.trigger('Js_HallMap:applySuperPosition');};return Js_HallMap_Stage;});