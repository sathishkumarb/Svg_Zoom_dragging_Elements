define(['jquery','underscore','d3','jquery.mousewheel'],function($,_){'use strict';var Js_HallMap_Tip=function(hallMap){this._hallMap=hallMap;this._$element=null;this._hidingTimerId=null;this._isVisible=false;this._primitiveNode=null;this._$element=$(document.createElement('div'));this._$element.addClass('jsHallMapTip hallMapTip');this._$element.css({opacity:0,left:'-10000px',top:'-10000px'});this._$content=$(document.createElement('div'));this._$content.addClass('content');this._$content.css({});this._$element.append(this._$content);var $tail=$(document.createElement('div'));$tail.addClass('tail');this._$element.append($tail);$(this._hallMap.getElement()).append(this._$element[0]);this._$element.mouseenter(_.bind(function(){if(this._hidingTimerId){window.clearTimeout(this._hidingTimerId);this._hidingTimerId=null;}},this));this._$element.mouseleave(_.bind(function(event){if(this._hidingTimerId){window.clearTimeout(this._hidingTimerId);this._hidingTimerId=null;}
this._hide();},this));this._$element.mousewheel(_.bind(function(event){if(this._hidingTimerId){window.clearTimeout(this._hidingTimerId);this._hidingTimerId=null;}
this._hide();},this));};Js_HallMap_Tip.prototype.isVisible=function(){return this._isVisible;};Js_HallMap_Tip.prototype.show=function(html,primitiveNode){if(this._hidingTimerId){window.clearTimeout(this._hidingTimerId);}
this._$content.html(html);this._primitiveNode=primitiveNode;this._$element.css({opacity:1});this._isVisible=true;this.positionate();};Js_HallMap_Tip.prototype.delayedHide=function(delay){if(this._isVisible){if(this._hidingTimerId){window.clearTimeout(this._hidingTimerId);}
this._hidingTimerId=window.setTimeout(_.bind(this._hide,this),delay);}};Js_HallMap_Tip.prototype.hide=function(){if(this._isVisible){this._hide();}};Js_HallMap_Tip.prototype.positionate=function(){if(!this._isVisible){return;}
var screenBorder,left,top;try{screenBorder=this._hallMap.getPrimitiveNodeScreenBorder(this._primitiveNode);}catch(ex){return;}
left=screenBorder.x1-((this._$element.width()-screenBorder.width)/2);top=screenBorder.y1-this._$element.height();this._$element.css({left:Math.round(left)+15+'px',top:Math.round(top)-30+'px'});};Js_HallMap_Tip.prototype._hide=function(){this._isVisible=false;this._primitiveNode=null;this._$content.html('');this._$element.css({opacity:0,left:'-10000px',top:'-10000px'});};return Js_HallMap_Tip;});